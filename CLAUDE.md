# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Development
```bash
npm run dev          # Start Astro dev server (access at http://192.168.50.5:4321)
npm run build        # Build production site to dist/
npm run preview      # Preview production build locally
npm run astro        # Access Astro CLI directly
```

**Important**: The dev server should always run on `0.0.0.0` to be accessible at `http://192.168.50.5:4321`. Use:
```bash
npm run dev -- --host 0.0.0.0
```

### Astro CLI Commands
```bash
npx astro add        # Add integrations
npx astro check      # Check for TypeScript errors
npx astro sync       # Generate TypeScript types for content collections
```

## Architecture

### Tech Stack
- **Framework**: Astro.js v5 with SSR enabled (Vercel adapter)
- **Styling**: Tailwind CSS with custom mint green theme
- **Email**: Nodemailer for contact form submissions
- **Analytics**: Google Tag Manager integration
- **TypeScript**: Strict mode enabled

### Project Structure

```
src/
├── pages/             # Routes - file-based routing
│   ├── api/          # API endpoints (contact.ts for form handling)
│   ├── blog/         # Blog pages (index and [slug] dynamic routes)
│   ├── formulations/ # Dynamic routes with [format].astro
│   └── services/     # Service pages
│       └── _drafts/  # Unpublished service pages (not built)
├── components/       # Reusable Astro components
│   └── BlogCard.astro # Blog post preview cards
├── layouts/         # BaseLayout.astro wraps all pages
├── content/         # Content collections (Astro Content Layer)
│   ├── blog/        # Markdown blog posts
│   └── dosage-forms/ # Dosage form content
└── data/           # JS data files (services, formulations, etc.)
```

### Key Patterns

1. **Dynamic Routes**: The `[format].astro` pattern in formulations/ creates pages based on formulation data; `[slug].astro` in blog/ creates individual blog post pages
2. **Component Composition**: All pages use BaseLayout.astro with SEO metadata
3. **Content Collections**: Blog posts and dosage forms use Astro's Content Layer API with glob loaders defined in `src/content/config.ts`
4. **Data Management**: Product data stored in src/data/ as JavaScript modules; blog content in Markdown files
5. **Image Optimization**: Scripts in scripts/ folder for image processing with sharp-cli
6. **Environment Variables**: SMTP configuration in .env for contact form
7. **Canonical URLs**: Automatically generated by BaseLayout.astro using `Astro.url.pathname` and `Astro.site` - DO NOT hardcode canonical URLs in individual pages
8. **SSR Mode**: Site runs in SSR mode with Vercel adapter - dynamic routes use `getEntry()` at runtime instead of `getStaticPaths()` only

### API Endpoints
- `/api/contact` - Handles contact form submissions via Nodemailer

### Content Collections & Blog

Blog functionality using Astro's Content Layer API:
- **Blog Posts**: Markdown files in `src/content/blog/`
- **Collection Config**: Defined in `src/content/config.ts` with glob loader
- **Blog Routes**:
  - `/blog` - Main blog listing page
  - `/blog/[slug]` - Individual blog post pages
  - `/blog/tag/[tag]` - Tag filtering (planned)
- **Adding New Posts**: Create `.md` files in `src/content/blog/` with required frontmatter (title, description, pubDate, author, tags, draft)
- **SEO Optimized**: All posts include proper meta descriptions, structured headings, and internal linking

### Deployment
- Site deployed on Vercel (output: 'server', adapter: vercel())
- Domain: https://nutricraftlabs.com
- Sitemap includes dynamic formulation pages and blog posts

### Image Optimization
Image optimization scripts available in scripts/ directory:
- `optimize-formulation-images.sh` - Creates multiple sizes and WebP formats
- `convert-png-to-jpg.sh` - Batch converts PNG to JPG
- Various format-specific optimization scripts

### Forms & Contact
Contact form uses server-side processing with:
- Validation on both client and server
- Nodemailer for SMTP email sending
- Environment variables for SMTP configuration

### Analytics & Tracking
- Google Tag Manager integration via Analytics.astro component
- Conversion tracking documentation in CONVERSION_TRACKING.md
- GTM setup guide in GTM_SETUP.md

## Development Notes

- TypeScript strict mode is enabled
- No ESLint or Prettier configuration (consider adding for consistency)
- Tests directory exists but is currently empty
- Public images should be placed in public/images/ with WebP versions for performance
- Dynamic formulation pages are pre-configured in sitemap via astro.config.mjs
- The brand of this project is "Nutricraft Labs"