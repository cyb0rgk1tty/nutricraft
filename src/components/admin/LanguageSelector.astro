---
/**
 * Language Selector Component
 * Toggle between English and Chinese for the dashboard
 */
---

<div class="language-selector flex items-center gap-1 bg-gray-100 rounded-lg p-0.5">
  <button
    type="button"
    class="lang-btn lang-btn-en px-2.5 py-1 text-xs font-medium rounded-md transition-all"
    data-lang="en"
  >
    EN
  </button>
  <button
    type="button"
    class="lang-btn lang-btn-zh px-2.5 py-1 text-xs font-medium rounded-md transition-all"
    data-lang="zh"
  >
    中文
  </button>
</div>

<style>
  .lang-btn {
    color: #6b7280;
    background-color: transparent;
  }
  .lang-btn:hover {
    color: #374151;
    background-color: #e5e7eb;
  }
  .lang-btn.active {
    color: white;
    background-color: #00c16e;
    box-shadow: 0 1px 2px rgba(0, 193, 110, 0.2);
  }
</style>

<script>
  import { getLanguage, setLanguage, type Language } from '../../utils/i18n';

  // Get all language selector instances on the page
  const selectors = document.querySelectorAll('.language-selector');

  // Initialize button states for all selectors
  function updateAllButtonStates() {
    const currentLang = getLanguage();
    document.querySelectorAll('.lang-btn-en').forEach(btn => {
      btn.classList.toggle('active', currentLang === 'en');
    });
    document.querySelectorAll('.lang-btn-zh').forEach(btn => {
      btn.classList.toggle('active', currentLang === 'zh');
    });
  }

  // Set initial state
  updateAllButtonStates();

  // Handle button clicks for all instances
  selectors.forEach(selector => {
    const btnEn = selector.querySelector('.lang-btn-en');
    const btnZh = selector.querySelector('.lang-btn-zh');

    btnEn?.addEventListener('click', () => {
      setLanguage('en');
      updateAllButtonStates();
    });

    btnZh?.addEventListener('click', () => {
      setLanguage('zh');
      updateAllButtonStates();
    });
  });

  // Listen for language changes from other sources
  window.addEventListener('languageChanged', () => {
    updateAllButtonStates();
  });
</script>
