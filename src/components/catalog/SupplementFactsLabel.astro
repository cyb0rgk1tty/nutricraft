---
/**
 * SupplementFactsLabel Component
 * Generates a formatted Supplement Facts panel using HTML/CSS
 * Follows FDA/Health Canada label formatting standards
 */

interface Ingredient {
  name: string;
  amount: string;
  unit: string;
  dailyValue?: string;
  source?: string;
}

interface Props {
  servingSize: string;
  servingsPerContainer: number | string;
  ingredients?: Ingredient[];
  otherIngredients?: string;
  allergenInfo?: string;
}

const {
  servingSize,
  servingsPerContainer,
  ingredients = [],
  otherIngredients,
  allergenInfo
} = Astro.props;

// Check if we have ingredients data
const hasIngredients = ingredients && ingredients.length > 0;
---

<div class="supplement-facts">
  <!-- Header -->
  <div class="sf-header">Supplement Facts</div>

  <!-- Serving Info -->
  <div class="sf-serving">
    <div class="sf-serving-size">Serving Size: {servingSize}</div>
    <div class="sf-servings-container">Servings Per Container: {servingsPerContainer}</div>
  </div>

  {hasIngredients ? (
    <>
      <!-- Column Headers -->
      <div class="sf-column-header">
        <span class="sf-col-left"></span>
        <span class="sf-col-amount">Amount Per Serving</span>
        <span class="sf-col-dv">% DV*</span>
      </div>

      <!-- Ingredients -->
      <div class="sf-ingredients">
        {ingredients.map((ingredient) => (
          <div class="sf-row">
            <div class="sf-ingredient-info">
              <span class="sf-ingredient-name">{ingredient.name}</span>
              {ingredient.source && (
                <span class="sf-source">{ingredient.source}</span>
              )}
            </div>
            <span class="sf-ingredient-amount">
              {ingredient.amount} {ingredient.unit}
            </span>
            <span class="sf-ingredient-dv">
              {ingredient.dailyValue || '*'}
            </span>
          </div>
        ))}
      </div>

      <!-- Footer -->
      <div class="sf-footer">
        <p class="sf-dv-note">* Daily Value not established.</p>

        {otherIngredients && (
          <p class="sf-other">
            <strong>Other Ingredients:</strong> {otherIngredients}
          </p>
        )}

        {allergenInfo && (
          <p class="sf-allergen">
            <strong>Contains:</strong> {allergenInfo}
          </p>
        )}
      </div>
    </>
  ) : (
    <!-- No ingredients data placeholder -->
    <div class="sf-no-data">
      <p>Full ingredient list coming soon.</p>
    </div>
  )}
</div>

<style>
  .supplement-facts {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background: #ffffff;
    border: 1px solid #000000;
    padding: 8px 10px;
    width: 100%;
    max-width: 280px;
    font-size: 11px;
    line-height: 1.3;
    color: #000000;
  }

  /* Header */
  .sf-header {
    font-size: 24px;
    font-weight: 900;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    margin-bottom: 2px;
    letter-spacing: -0.5px;
    line-height: 1.1;
  }

  /* Serving Info */
  .sf-serving {
    border-bottom: 8px solid #000000;
    padding-bottom: 4px;
    margin-bottom: 4px;
  }

  .sf-serving-size {
    font-weight: 700;
    font-size: 11px;
  }

  .sf-servings-container {
    font-size: 11px;
  }

  /* Column Headers */
  .sf-column-header {
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
    border-bottom: 1px solid #000000;
    padding: 3px 0;
    font-size: 8px;
    font-weight: 700;
  }

  .sf-col-left {
    flex: 1;
  }

  .sf-col-amount {
    width: 80px;
    text-align: right;
    padding-right: 8px;
  }

  .sf-col-dv {
    width: 40px;
    text-align: right;
  }

  /* Ingredients */
  .sf-ingredients {
    border-bottom: 5px solid #000000;
  }

  .sf-row {
    display: flex;
    align-items: flex-start;
    padding: 4px 0;
    border-bottom: 1px solid #cccccc;
    font-size: 11px;
  }

  .sf-row:last-child {
    border-bottom: none;
  }

  .sf-ingredient-info {
    flex: 1;
    padding-right: 4px;
    min-width: 0;
  }

  .sf-ingredient-name {
    font-weight: 700;
    display: block;
    word-wrap: break-word;
  }

  .sf-source {
    font-weight: 400;
    font-size: 9px;
    color: #333333;
    display: block;
    padding-left: 8px;
    line-height: 1.4;
    word-wrap: break-word;
  }

  .sf-ingredient-amount {
    width: 80px;
    text-align: right;
    padding-right: 8px;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .sf-ingredient-dv {
    width: 40px;
    text-align: right;
    font-weight: 700;
    flex-shrink: 0;
  }

  /* Footer */
  .sf-footer {
    padding-top: 4px;
    font-size: 8px;
  }

  .sf-dv-note {
    margin: 0 0 6px 0;
  }

  .sf-other {
    margin: 6px 0;
    line-height: 1.4;
    word-wrap: break-word;
  }

  .sf-allergen {
    margin: 6px 0;
    line-height: 1.4;
  }

  .sf-other strong,
  .sf-allergen strong {
    font-weight: 700;
  }

  /* No data placeholder */
  .sf-no-data {
    padding: 20px 10px;
    text-align: center;
    color: #666666;
    font-size: 10px;
    border-top: 1px solid #cccccc;
  }

  .sf-no-data p {
    margin: 0;
  }
</style>
