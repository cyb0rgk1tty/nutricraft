---
const navItems = [
  { label: "Services", href: "/services" },
  { label: "Who We Serve", href: "/who-we-serve" },
  { label: "Dosage Forms", href: "/dosage-forms" },
  { label: "Blog", href: "/blog" },
  {
    label: "About",
    href: "/about",
    dropdown: [
      { label: "Our Team", href: "/our-team" },
      { label: "How We Work", href: "/about" },
    ]
  },
  { label: "Schedule Call", href: "/schedule-call" },
];
---

<header
  class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-gray-100"
>
  <nav class="section-container">
    <div class="flex items-center justify-between h-16 md:h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center">
        <picture>
          <source
            srcset="/images/logo-header-mobile.webp 1x, /images/logo-header.webp 2x"
            type="image/webp"
            media="(max-width: 768px)"
          />
          <source
            srcset="/images/logo-header.webp 1x, /images/logo-header-2x.webp 2x"
            type="image/webp"
            media="(min-width: 769px)"
          />
          <img
            src="/images/logo.png"
            alt="Nutricraft Labs - Private Label Supplements"
            class="h-5 md:h-7 lg:h-8 w-auto"
            width="300"
            height="30"
            loading="eager"
          />
        </picture>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        {
          navItems.map((item) => (
            item.dropdown ? (
              <div class="relative group">
                <button
                  class="flex items-center gap-1 text-gray-700 hover:text-primary transition-colors duration-200 font-medium"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  {item.label}
                  <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                  <div class="bg-white rounded-lg shadow-lg border border-gray-100 py-2 min-w-[160px]">
                    {item.dropdown.map((subItem) => (
                      <a
                        href={subItem.href}
                        class="block px-4 py-2 text-gray-700 hover:bg-mint-50 hover:text-mint-600 transition-colors duration-200"
                      >
                        {subItem.label}
                      </a>
                    ))}
                  </div>
                </div>
              </div>
            ) : (
              <a
                href={item.href}
                class="text-gray-700 hover:text-primary transition-colors duration-200 font-medium"
              >
                {item.label}
              </a>
            )
          ))
        }
        <a href="/contact" class="btn-primary"> Get Started </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 rounded-lg hover:bg-gray-100"
        aria-label="Toggle mobile menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden pb-4">
      <div class="flex flex-col space-y-1">
        {
          navItems.map((item) => (
            item.dropdown ? (
              <div class="mobile-dropdown">
                <button
                  class="mobile-dropdown-toggle flex items-center justify-between w-full text-gray-700 hover:text-primary transition-colors duration-200 font-medium py-2"
                  aria-expanded="false"
                >
                  {item.label}
                  <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <div class="mobile-dropdown-content hidden pl-4 space-y-1">
                  {item.dropdown.map((subItem) => (
                    <a
                      href={subItem.href}
                      class="block text-gray-600 hover:text-mint-600 transition-colors duration-200 py-2"
                    >
                      {subItem.label}
                    </a>
                  ))}
                </div>
              </div>
            ) : (
              <a
                href={item.href}
                class="text-gray-700 hover:text-primary transition-colors duration-200 font-medium py-2"
              >
                {item.label}
              </a>
            )
          ))
        }
        <a href="/contact" class="btn-primary text-center mt-2"> Get Started </a>
      </div>
    </div>
  </nav>
</header>

<script>
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  mobileMenuButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
  });

  // Close mobile menu when clicking on a link (but not dropdown toggles)
  const mobileLinks = mobileMenu?.querySelectorAll("a");
  mobileLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu?.classList.add("hidden");
    });
  });

  // Mobile dropdown toggle
  const mobileDropdownToggles = document.querySelectorAll(".mobile-dropdown-toggle");
  mobileDropdownToggles.forEach((toggle) => {
    toggle.addEventListener("click", () => {
      const content = toggle.nextElementSibling;
      const icon = toggle.querySelector("svg");

      if (content?.classList.contains("hidden")) {
        content.classList.remove("hidden");
        icon?.classList.add("rotate-180");
        toggle.setAttribute("aria-expanded", "true");
      } else {
        content?.classList.add("hidden");
        icon?.classList.remove("rotate-180");
        toggle.setAttribute("aria-expanded", "false");
      }
    });
  });
</script>
