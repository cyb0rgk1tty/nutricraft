---
/**
 * Admin Layout
 * Shared layout for all admin pages with sidebar navigation
 *
 * Features:
 * - Sidebar navigation (fixed on desktop, slide-in on mobile)
 * - Authentication state passed to sidebar
 * - Consistent page structure
 * - Mobile-responsive with hamburger menu
 * - Role-based navigation filtering
 */

import BaseLayout from './BaseLayout.astro';
import AdminSidebar from '../components/admin/AdminSidebar.astro';
import { verifySession } from '../utils/adminAuth';
import type { UserRole } from '../utils/rbac';

interface Props {
  title: string;
  description?: string;
  currentPage: 'dashboard' | 'quotes' | 'settings' | 'audit-logs' | 'google-ads' | 'invoices' | 'airwallex' | 'users';
}

const { title, description = 'Admin Dashboard', currentPage } = Astro.props;

// Get authentication state
const authResult = await verifySession(Astro.request);
const user = authResult?.user;
const userRole: UserRole = user?.role || 'manufacturer';
---

<BaseLayout title={title} description={description} noindex={true} noChat={true}>
  <div class="min-h-screen bg-gray-50">
    <!-- Sidebar -->
    <AdminSidebar
      currentPage={currentPage}
      userRole={userRole}
      username={user?.username}
    />

    <!-- Main Content Area -->
    <div class="lg:ml-64 min-h-screen">
      <!-- Mobile header spacer -->
      <div class="h-16 lg:hidden"></div>

      <!-- Page Content -->
      <main>
        <slot />
      </main>
    </div>
  </div>
</BaseLayout>
